web:
  build: .
  volumes:
    - ./{{ project_name }}:/code
  links:
   - db
   - redis
  ports:
   - 5000:5000
  command: python3 manage.py runserver 0.0.0.0:5000
  environment:
    DATABASE_URL: 'postgres://postgres:postgres@db_1:5432/postgres'
    DEBUG: 1
    DJANGO_SETTINGS_MODULE: '{{ project_name }}.settings'
    REDIS_URL: 'redis://redis_1:6379'
    SECRET_KEY: '{{ secret_key }}'

worker:
  build: .
  volumes:
    - ./{{ project_name }}:/code
  links:
   - db
   - redis
  command: celery -A {{ project_name }} worker -l info
  environment:
    C_FORCE_ROOT: 'True'
    DATABASE_URL: 'postgres://postgres:postgres@db_1:5432/postgres'
    DEBUG: 1
    DJANGO_SETTINGS_MODULE: '{{ project_name }}.settings'
    REDIS_URL: 'redis://redis_1:6379'
    SECRET_KEY: '{{ secret_key }}'

db:
  image: postgres

redis:
  image: redis
