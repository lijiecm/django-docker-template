web:
  build: .
  volumes:
    - ./{{ project_name }}:/code
  links:
   - db
   - redis
  ports:
   - 5000:5000
  command: python3 manage.py runserver 0.0.0.0:5000
  environment:
    AWS_ACCESS_KEY_ID: ''
    AWS_SECRET_ACCESS_KEY: ''
    AWS_STORAGE_BUCKET_NAME: ''
    AWS_S3_CUSTOM_DOMAIN: ''
    DATABASE_URL: 'postgres://docker:docker@db_1:5432/docker'
    DEBUG: 1
    DJANGO_SETTINGS_MODULE: '{{ project_name }}.settings'
    REDIS_URL: 'redis://redis_1:6379'
    SECRET_KEY: '{{ secret_key }}'

worker:
  build: .
  volumes:
    - ./{{ project_name }}:/code
  links:
   - db
   - redis
  command: celery -A {{ project_name }} worker -l info
  environment:
    AWS_ACCESS_KEY_ID: ''
    AWS_SECRET_ACCESS_KEY: ''
    AWS_STORAGE_BUCKET_NAME: ''
    AWS_S3_CUSTOM_DOMAIN: ''
    C_FORCE_ROOT: 'True'
    DATABASE_URL: 'postgres://docker:docker@db_1:5432/docker'
    DEBUG: 1
    DJANGO_SETTINGS_MODULE: '{{ project_name }}.settings'
    REDIS_URL: 'redis://redis_1:6379'
    SECRET_KEY: '{{ secret_key }}'

db:
  image: postgresql

redis:
  image: redis
